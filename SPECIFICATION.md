# ワンこねくと 仕様書

## 1. アプリ概要

| 項目 | 内容 |
|------|------|
| **アプリ名** | ワンこねくと（旧称：いぬさんぽ） |
| **アプリID** | `com.kerofen.inusanpo` |
| **ジャンル** | パズルゲーム（一筆書き系） |
| **対象プラットフォーム** | Web / iOS / Android |
| **開発フレームワーク** | Phaser 3 + Vite + Capacitor |

### コンセプト
同じ種類のワンコを繋いで、グリッドの全マスを埋める一筆書きパズルゲーム。かわいい犬のキャラクターと一緒に、おさんぽ気分でパズルを楽しめます。

---

## 2. ゲームルール

### 基本ルール
1. **6×6のグリッド**上に、同じ種類の「ワンコ」が2つずつ配置されている（3〜4ペア）
2. プレイヤーは**同じ種類のワンコ同士を線（肉球トレイル）でつなぐ**
3. 線は**上下左右に隣接するマスのみ**通過できる（斜め移動不可）
4. 線同士は**交差・重複できない**
5. **全てのマスを線で埋める**とステージクリア

### ワンコの種類（1ステージあたり3〜4種類）
- ステージごとに32種類の犬種から3〜4種類がランダムに選ばれる
- 同じ種類のワンコは必ず2匹ずつ配置される
- ペアを繋ぐと、その犬種の色で経路が塗られる

---

## 3. ゲームモード

### 3.1 ストーリーモード（通常モード）
- **100ステージ**を順番にクリアしていく
- ステージは**シード固定の乱数**で自動生成（同じステージ番号なら同じ配置）
- クリア状態は`localStorage`に保存
- ステージセレクトからいつでも好きなステージをプレイ可能

#### 難易度設定
| ステージ範囲 | 難易度 | パス数 |
|--------------|--------|--------|
| 1〜30 | ★☆☆ | 3本 |
| 31〜60 | ★★☆ | 3〜4本 |
| 61〜100 | ★★★ | 4本 |

### 3.2 チャレンジモード
- **エンドレスモード**：ミスするまで続ける
- ランダム生成されたステージを連続クリア
- **ミス条件**：ペアを完成させずに指を離すとゲームオーバー
- ハイスコア（連続クリア数）を記録
- 5ステージごとに難易度が上昇

---

## 4. UI/UX設計

### 4.1 画面構成

```
┌─────────────────────────────────────┐
│           タイトル画面               │
│  ・ゲーム開始ボタン                  │
│  ・ステージセレクトボタン            │
│  ・チャレンジモードボタン            │
│  ・ハイスコア表示                    │
└─────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────┐
│          ステージセレクト            │
│  ・100ステージのグリッド表示         │
│  ・クリア済みは★マーク表示          │
│  ・各ステージのプレビュー            │
└─────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────┐
│            ゲーム画面                │
│  ┌───────────────────────────────┐  │
│  │ [←] レベル表示   [進捗バー]   │  │
│  └───────────────────────────────┘  │
│  ┌───────────────────────────────┐  │
│  │                               │  │
│  │      6×6 パズルグリッド        │  │
│  │                               │  │
│  └───────────────────────────────┘  │
│  ┌───────────────────────────────┐  │
│  │   [リセット]    [ヒント]      │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────┐
│           クリア画面                 │
│  ・クリア演出                        │
│  ・次のステージへボタン              │
└─────────────────────────────────────┘
```

### 4.2 デザインシステム（桜井イズム準拠）

#### カラーパレット
```javascript
const PALETTE = {
    // 背景
    sky: 0x87CEEB,      // 明るい空色
    grass: 0x8FBC8F,    // 草原
    
    // セル
    cellBg: 0xFFFAF0,   // 温かみのある白
    cellOutline: 0x4A4A4A,
    
    // UI
    uiBg: 0xFFFDF5,
    uiOutline: 0x5D4E37,
};
```

#### テキストスタイル階層
| レベル | 用途 | サイズ | 特徴 |
|--------|------|--------|------|
| title | ゲーム名、クリア！ | 32px | 縁取り6px + 影 |
| heading | 画面タイトル | 20px | 縁取り3px |
| section | セクション名 | 16px | 縁取り4px + 影 |
| body | 本文 | 16px | 縁取りなし |
| button | ボタン（大） | 22px | 縁取り4px + 影 |
| score | スコア表示 | 48px | 金色 + 縁取り5px |

#### ボタンフィードバック
- **押下時**: 0.92倍に縮小 + ハプティクス（Light）
- **離した時**: 1.08倍に膨らんでから1.0に戻る（Back.easeOut）
- **連打防止**: 150ms の処理ロック

---

## 5. 犬キャラクター

### 5.1 犬種一覧（全32種類）

#### 初期解放（4種）
| ID | 名前 | 特徴 |
|----|------|------|
| 1 | 柴犬 | とがった耳、丸い目 |
| 2 | パグ | 垂れ耳、大きい目、しわ |
| 3 | トイプードル | カーリー耳、ふわふわ |
| 4 | ハスキー | とがった耳、アーモンド目、マスク模様 |

#### 実績解放（24種）
| ID | 名前 | 解放条件 |
|----|------|----------|
| 5 | ゴールデンレトリバー | 合計5ステージクリア |
| 6 | コーギー | 合計10ステージクリア |
| 7 | ダルメシアン | 合計15ステージクリア |
| 8 | チワワ | 合計20ステージクリア |
| 9 | シュナウザー | 合計30ステージクリア |
| 10 | ドーベルマン | 合計40ステージクリア |
| 11 | セントバーナード | 合計50ステージクリア |
| 12 | ボルゾイ | 合計60ステージクリア |
| 13 | バーニーズ | 合計80ステージクリア |
| 14 | サモエド | 合計100ステージクリア |
| 15 | グレートデン | 累計100ピース消す |
| 16 | キャバリア | 累計ピース数で解放 |
| 17 | ジャックラッセルテリア | 累計ピース数で解放 |
| 18 | パピヨン | 累計ピース数で解放 |
| 19 | ブルドッグ | 累計ピース数で解放 |
| 21〜27 | その他犬種 | 各種実績で解放 |
| 30 | ボーダーコリー | 実績解放 |
| 31 | ビーグル | 実績解放 |

#### 隠し犬種（4種）
| ID | 名前 | 入手方法 |
|----|------|----------|
| 20 | 黒柴 | 隠し条件で解放 |
| 28 | チャイニーズクレステッド | 隠し条件で解放 |
| 29 | ゴールデンワンコ | ステージ選択で1/50の確率で遭遇（超レア） |
| 32 | マルチーズ | コンプリート報酬 |

### 5.2 表情バリエーション
各犬種に4種類の表情画像を用意：
- `normal` - 通常
- `happy` - 嬉しい
- `excited` - 興奮
- `sad` - 悲しい

---

## 6. ビジュアルエフェクト

### 6.1 肉球トレイル
- 線を引くと、経路上に**肉球マーク**が表示される
- こげ茶色（`#5D4037`）のぷにぷにした見た目
- グラデーションで立体感を表現
- メインパッド + 4つの指パッドで構成

### 6.2 アニメーション
| 対象 | 効果 |
|------|------|
| タイトル犬 | バウンスアニメーション（上下）|
| ボタン押下 | 縮小 → 膨らみ → 元に戻る |
| クリア演出 | ポップイン + 星のスピン |
| ゲームオーバー | シェイクアニメーション |
| 浮遊肉球 | ゆらゆら浮遊 |

---

## 7. ステージ生成アルゴリズム

### 7.1 生成保証
- **100%解ける**パズルのみ生成
- 全マスが必ず埋まる
- 同じ種類のワンコは隣接しない

### 7.2 アルゴリズム概要
1. グリッド全体を1本の**蛇行パス**で埋める
2. そのパスを3〜4本の**連続したセグメント**に分割
3. 各セグメントの端点が**ワンコの位置**になる

### 7.3 シード固定乱数
- **Mulberry32アルゴリズム**を使用
- ステージ番号 × 12345 をシードとして使用
- 同じシードなら常に同じステージが生成される

---

## 8. データ永続化

### 8.1 LocalStorage キー

| キー | 内容 | 型 |
|------|------|------|
| `inusanpo_cleared` | クリア済みステージIDの配列 | `number[]` |
| `challengeHighScore` | チャレンジモードのハイスコア | `string` (数値) |

### 8.2 レベルデータ構造
```typescript
interface LevelData {
    id: number;
    name: string;
    gridSize: number;       // 6
    pathCount: number;      // 3〜4
    dogs: DogPosition[];    // ワンコの配置
    solution?: Path[];      // 解答データ
    difficulty: number;     // 1〜3
}

interface DogPosition {
    row: number;
    col: number;
    type: number;           // 犬種ID（1〜32）
}

interface Path {
    id: number;
    cells: Cell[];
    start: Cell;
    end: Cell;
    length: number;
}
```

---

## 9. 技術仕様

### 9.1 技術スタック

| カテゴリ | 技術 | バージョン |
|----------|------|------------|
| ゲームエンジン | Phaser | 3.80.1 |
| ビルドツール | Vite | 5.4.0 |
| モバイル化 | Capacitor | 6.0.0 |
| ハプティクス | @capacitor/haptics | 8.0.0 |
| 画像処理 | Sharp | 0.34.5 |
| デプロイ | gh-pages | 6.3.0 |

### 9.2 ビルドコマンド

```bash
# 開発サーバー起動
npm run dev

# プロダクションビルド
npm run build

# GitHub Pages用ビルド
npm run build:gh-pages

# GitHub Pagesへデプロイ
npm run deploy

# Capacitorの同期
npm run cap:sync

# Android Studio を開く
npm run cap:open:android

# Xcode を開く
npm run cap:open:ios
```

### 9.3 ディレクトリ構造

```
inusanpo/
├── assets/
│   ├── characters/      # 犬キャラクター画像（32種×4表情）
│   ├── gazou/           # その他画像素材
│   ├── k-font/          # けいフォント
│   └── title/           # タイトル画像
├── public/
│   └── assets/          # ビルド後の静的アセット
├── scripts/             # Python画像処理スクリプト
├── game.js              # メインゲームロジック（Phaser）
├── main.js              # Canvas版（レガシー）
├── levelGenerator.js    # ステージ自動生成
├── HapticManager.js     # ハプティクス管理
├── effects.js           # エフェクト
├── style.css            # スタイルシート
├── index.html           # エントリーポイント
├── vite.config.js       # Vite設定
├── capacitor.config.ts  # Capacitor設定
└── package.json         # 依存関係
```

---

## 10. モバイル対応

### 10.1 セーフエリア対応
- iOS のノッチ/ホームインジケータに対応
- Android 15+ の Edge-to-Edge に対応
- `env(safe-area-inset-*)` を使用

### 10.2 タッチ操作
- `touchstart` / `touchmove` / `touchend` イベント対応
- `passive: false` でスクロール防止
- `-webkit-user-select: none` で選択防止

### 10.3 ハプティクスフィードバック
```javascript
HapticManager.impact('Light');   // 軽いフィードバック
HapticManager.impact('Medium');  // 中程度のフィードバック
HapticManager.impact('Heavy');   // 強いフィードバック
```

---

## 11. カスタムフォント

### けいフォント
- **ファイル**: `keifont.ttf`
- **ライセンス**: Apache License 2.0（源真ゴシック・源ノ角ゴシック派生）
- **用途**: ゲーム内全テキスト
- **フォールバック**: `-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif`

---

## 12. 実装済み機能 / 今後の拡張予定

### 実装済み
- [x] 実績システム（犬種解放）
- [x] 肉球トレイルエフェクト
- [x] ハプティクスフィードバック
- [x] チャレンジモード
- [x] ステージセレクト
- [x] クリア状態の保存

### 今後の拡張予定
- [ ] サウンドエフェクト追加
- [ ] BGM追加
- [ ] 肉球カラーカスタマイズ
- [ ] 背景テーマ変更
- [ ] ソーシャル機能（スコア共有）
- [ ] 広告実装
- [ ] 課金アイテム

---

## 改訂履歴

| 日付 | バージョン | 内容 |
|------|------------|------|
| 2026-01-24 | 1.0.0 | 初版作成 |
| 2026-01-24 | 1.0.1 | おやつ→ワンコに修正、ステージ数500→100に修正、犬種32種類の詳細追加 |
