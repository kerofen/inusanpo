import{P as g}from"./phaser-0RJB29YE.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function s(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(e){if(e.ep)return;e.ep=!0;const o=s(e);fetch(e.href,o)}})();class k{constructor(t=6){this.gridSize=t,this.totalCells=t*t}generate(t={}){const{difficulty:s=2,maxAttempts:i=100}=t;for(let e=0;e<i;e++){const o=this.generateOnce();if(o&&this.strictValidate(o))return this.formatLevelData(o,s)}return console.error("„É¨„Éô„É´ÁîüÊàê„Å´Â§±Êïó"),null}generateOnce(){const t=this.generateSnakePath(),s=Math.random()<.5?3:4,i=this.splitPathSafely(t,s);if(!i||this.hasAdjacentEndpoints(i))return null;const e=this.createEmptyGrid(),o=i.map((n,r)=>{const a=r+1;return n.forEach(c=>{e[c.row][c.col]=a}),{id:a,cells:[...n],start:{...n[0]},end:{...n[n.length-1]},length:n.length}});return{grid:e,paths:o}}generateSnakePath(){const t=[];switch(Math.floor(Math.random()*4)){case 0:this.snakeHorizontal(t,0,1);break;case 1:this.snakeHorizontal(t,this.gridSize-1,-1);break;case 2:this.snakeVertical(t,0,1);break;case 3:this.snakeVertical(t,this.gridSize-1,-1);break}return t}snakeHorizontal(t,s,i){for(let e=0;e<this.gridSize;e++)if(e%2===0==(i===1))for(let n=0;n<this.gridSize;n++)t.push({row:e,col:n});else for(let n=this.gridSize-1;n>=0;n--)t.push({row:e,col:n})}snakeVertical(t,s,i){for(let e=0;e<this.gridSize;e++)if(e%2===0==(i===1))for(let n=0;n<this.gridSize;n++)t.push({row:n,col:e});else for(let n=this.gridSize-1;n>=0;n--)t.push({row:n,col:e})}splitPathSafely(t,s){const e=t.length;if(e<s*5)return null;const o=[0],n=Math.floor(e/s);for(let a=1;a<s;a++){const c=a*n,h=Math.floor(Math.random()*(n/2))-Math.floor(n/4);let d=c+h;const f=o[o.length-1]+5,u=e-(s-a)*5;d=Math.max(f,Math.min(u,d)),o.push(d)}o.push(e);const r=[];for(let a=0;a<o.length-1;a++){const c=o[a],h=o[a+1],d=t.slice(c,h);if(d.length<5)return null;r.push(d)}return r}hasAdjacentEndpoints(t){for(const s of t){const i=s[0],e=s[s.length-1];if(Math.abs(i.row-e.row)+Math.abs(i.col-e.col)<=1)return!0}return!1}strictValidate(t){const{grid:s,paths:i}=t;for(let o=0;o<this.gridSize;o++)for(let n=0;n<this.gridSize;n++)if(s[o][n]===0)return console.log(`‚ùå Ê§úË®ºÂ§±Êïó: (${o},${n})„ÅåÁ©∫`),!1;for(const o of i)for(let n=1;n<o.cells.length;n++){const r=o.cells[n-1],a=o.cells[n];if(Math.abs(r.row-a.row)+Math.abs(r.col-a.col)!==1)return console.log(`‚ùå Ê§úË®ºÂ§±Êïó: „Éë„Çπ${o.id}„Åå‰∏çÈÄ£Á∂ö (${r.row},${r.col})‚Üí(${a.row},${a.col})`),!1}if(i.length<3||i.length>4)return console.log(`‚ùå Ê§úË®ºÂ§±Êïó: „Éë„ÇπÊï∞„Åå${i.length}`),!1;for(const o of i)if(Math.abs(o.start.row-o.end.row)+Math.abs(o.start.col-o.end.col)<=1)return console.log(`‚ùå Ê§úË®ºÂ§±Êïó: „Éë„Çπ${o.id}„ÅÆÁ´ØÁÇπ„ÅåÈö£Êé•`),!1;const e=this.createEmptyGrid();for(const o of i)for(const n of o.cells){if(e[n.row][n.col]!==0)return console.log(`‚ùå Ê§úË®ºÂ§±Êïó: „Çª„É´ÈáçË§á (${n.row},${n.col})`),!1;e[n.row][n.col]=o.id}return!0}formatLevelData(t,s){const i=[];return t.paths.forEach((e,o)=>{const n=o+1;i.push({row:e.start.row,col:e.start.col,type:n}),i.push({row:e.end.row,col:e.end.col,type:n})}),{gridSize:this.gridSize,snacks:i,pathCount:t.paths.length,solution:t.paths,difficulty:s}}createEmptyGrid(){return Array.from({length:this.gridSize},()=>Array(this.gridSize).fill(0))}visualize(t){const s=this.createEmptyGrid(),i=["¬∑","‚ë†","‚ë°","‚ë¢","‚ë£"];t.snacks.forEach(o=>{s[o.row][o.col]=o.type});let e=`„ÄêÂïèÈ°å„Äë
`;for(let o=0;o<this.gridSize;o++)e+=s[o].map(n=>i[n]||"¬∑").join(" ")+`
`;return e}visualizeSolution(t){if(!t.solution)return"Ëß£Á≠î„Éá„Éº„Çø„Å™„Åó";const s=this.createEmptyGrid(),i=["¬∑","‚ë†","‚ë°","‚ë¢","‚ë£"];t.solution.forEach((o,n)=>{o.cells.forEach(r=>{s[r.row][r.col]=n+1})});let e=`„ÄêËß£Á≠î„Äë
`;for(let o=0;o<this.gridSize;o++)e+=s[o].map(n=>i[n]||"¬∑").join(" ")+`
`;return e}}const S={CELL_PADDING:6,CORNER_RADIUS:8},l={sky:16119280,grass:9419919,grassDark:7048811,ground:14596231,groundDark:12887411,wood:9139029,woodDark:7033668,cellBg:16775920,cellOutline:4868682,snack1:14711391,snack2:8499866,snack3:15912079,snack4:10338691,uiBg:16776693,uiOutline:6114871,textDark:"#4A4A4A",textLight:"#FFFFFF"},C={1:{color:l.snack1,name:"„Åä„Å´„Åè",icon:"snack_meat",key:"snack_meat"},2:{color:l.snack2,name:"„Åü„ÅÑ„ÇÑ„Åç",icon:"snack_taiyaki",key:"snack_taiyaki"},3:{color:l.snack3,name:"„ÇØ„ÉÉ„Ç≠„Éº",icon:"snack_bone",key:"snack_bone"},4:{color:l.snack4,name:"„Å†„Çì„Åî",icon:"snack_dango",key:"snack_dango"}};let p=[];class y{static roundedRect(t,s,i,e,o,n,r,a=l.cellOutline,c=2){t.fillStyle(r,1),t.fillRoundedRect(s,i,e,o,n),t.lineStyle(c,a,1),t.strokeRoundedRect(s,i,e,o,n)}static circle(t,s,i,e,o,n=l.cellOutline,r=2){t.fillStyle(o,1),t.fillCircle(s,i,e),t.lineStyle(r,n,1),t.strokeCircle(s,i,e)}static grassCluster(t,s,i,e=1){const o=t.add.graphics(),n=g.Math.Between(3,5);for(let r=0;r<n;r++){const a=s+(r-n/2)*6*e,c=g.Math.Between(12,20)*e,h=g.Math.Between(-3,3)*e;o.lineStyle(2*e,l.grassDark,1),o.beginPath(),o.moveTo(a,i),o.lineTo(a+h,i-c),o.strokePath()}return o}static flower(t,s,i,e=16777215){const o=t.add.container(s,i),n=t.add.graphics();n.fillStyle(e,1);for(let a=0;a<5;a++){const c=a/5*Math.PI*2,h=Math.cos(c)*6,d=Math.sin(c)*6;n.fillCircle(h,d,5)}const r=t.add.graphics();return r.fillStyle(16766720,1),r.fillCircle(0,0,4),o.add([n,r]),o}static tree(t,s,i,e=1){const o=t.add.container(s,i),n=t.add.graphics();n.fillStyle(l.wood,1),n.fillRect(-8*e,-20*e,16*e,40*e),n.lineStyle(2,l.woodDark,1),n.strokeRect(-8*e,-20*e,16*e,40*e);const r=t.add.graphics();return r.fillStyle(l.grass,1),r.fillCircle(0,-50*e,35*e),r.fillCircle(-25*e,-35*e,25*e),r.fillCircle(25*e,-35*e,25*e),r.lineStyle(2,l.grassDark,1),r.strokeCircle(0,-50*e,35*e),o.add([n,r]),o}static dogHouse(t,s,i,e=1){const o=t.add.container(s,i),n=t.add.graphics();n.fillStyle(l.wood,1),n.fillRect(-40*e,-30*e,80*e,60*e),n.lineStyle(2,l.woodDark,1),n.strokeRect(-40*e,-30*e,80*e,60*e);const r=t.add.graphics();r.fillStyle(13458524,1),r.beginPath(),r.moveTo(-50*e,-30*e),r.lineTo(0,-70*e),r.lineTo(50*e,-30*e),r.closePath(),r.fillPath(),r.lineStyle(2,9109504,1),r.strokePath();const a=t.add.graphics();return a.fillStyle(l.woodDark,1),a.fillCircle(0,10*e,20*e),a.fillRect(-20*e,10*e,40*e,20*e),o.add([n,r,a]),o}static fence(t,s,i,e,o=1){const n=t.add.graphics(),r=Math.floor(e/(20*o));n.fillStyle(l.wood,1),n.fillRect(s,i-25*o,e,8*o),n.fillRect(s,i-10*o,e,8*o),n.lineStyle(2,l.woodDark,1),n.strokeRect(s,i-25*o,e,8*o),n.strokeRect(s,i-10*o,e,8*o);for(let a=0;a<=r;a++){const c=s+a*(e/r);n.fillStyle(l.wood,1),n.fillRect(c-4*o,i-35*o,8*o,40*o),n.lineStyle(2,l.woodDark,1),n.strokeRect(c-4*o,i-35*o,8*o,40*o)}return n}static dogIcon(t,s,i,e=1,o="shiba_idle"){if(t.textures.exists(o)){const x=t.add.image(s,i,o);return x.setScale(e*.06),x}const n=t.add.container(s,i),r=14596231,a=t.add.graphics();a.fillStyle(r,1),a.fillEllipse(0,15*e,30*e,20*e),a.lineStyle(2,l.cellOutline,1),a.strokeEllipse(0,15*e,30*e,20*e);const c=t.add.graphics();c.fillStyle(r,1),c.fillCircle(0,-5*e,22*e),c.lineStyle(2,l.cellOutline,1),c.strokeCircle(0,-5*e,22*e);const h=t.add.graphics();h.fillStyle(r,1),h.fillEllipse(-18*e,-20*e,12*e,18*e),h.fillEllipse(18*e,-20*e,12*e,18*e),h.lineStyle(2,l.cellOutline,1),h.strokeEllipse(-18*e,-20*e,12*e,18*e),h.strokeEllipse(18*e,-20*e,12*e,18*e);const d=t.add.graphics();d.fillStyle(l.cellOutline,1),d.fillCircle(-8*e,-8*e,4*e),d.fillCircle(8*e,-8*e,4*e),d.fillStyle(16777215,1),d.fillCircle(-6*e,-10*e,1.5*e),d.fillCircle(10*e,-10*e,1.5*e);const f=t.add.graphics();f.fillStyle(l.cellOutline,1),f.fillCircle(0,0,4*e);const u=t.add.graphics();return u.lineStyle(2,l.cellOutline,1),u.beginPath(),u.moveTo(0,4*e),u.lineTo(0,8*e),u.moveTo(-6*e,10*e),u.lineTo(0,14*e),u.lineTo(6*e,10*e),u.strokePath(),n.add([a,h,c,d,f,u]),n}static snackIcon(t,s,i,e,o=20){const n=C[e];if(n.key&&t.textures.exists(n.key)){const c=t.add.image(s,i,n.key),h=t.textures.getFrame(n.key),d=h?h.width:c.width,u=o*2/d;return c.setScale(u),c}const r=t.add.container(s,i),a=t.add.graphics();return a.fillStyle(n.color,1),a.fillCircle(0,0,o*.5),a.lineStyle(2,l.cellOutline,1),a.strokeCircle(0,0,o*.5),r.add(a),r}static pawPrint(t,s,i,e,o=16){if(t.textures.exists("paw_print")){const c=t.add.image(s,i,"paw_print"),d=o*2/c.width;return c.setScale(d),e!==void 0&&c.setTint(e),c}const n=t.add.container(s,i),r=t.add.graphics();return r.fillStyle(e,1),r.fillEllipse(0,3,o*.6,o*.5),[{x:-o*.35,y:-o*.2},{x:-o*.12,y:-o*.35},{x:o*.12,y:-o*.35},{x:o*.35,y:-o*.2}].forEach(c=>{r.fillCircle(c.x,c.y,o*.18)}),n.add(r),n}}class R extends g.Scene{constructor(){super({key:"BootScene"})}preload(){this.load.image("shiba_idle","assets/shiba_idle.png"),this.load.image("shiba_walk","assets/shiba_walk.png"),this.load.image("shiba_happy","assets/shiba_happy.png"),this.load.image("snack_meat","assets/snack_meat.png"),this.load.image("snack_taiyaki","assets/snack_taiyaki.png"),this.load.image("snack_bone","assets/snack_bone.png"),this.load.image("snack_dango","assets/snack_dango.png"),this.load.image("paw_print","assets/paw_print.png"),this.load.image("particle_sparkle","assets/particle_sparkle.png"),this.load.image("particle_heart","assets/particle_heart.png"),this.load.image("particle_star","assets/particle_star.png"),this.load.image("bg_japanese","assets/bg_japanese.png"),this.load.image("ui_button","assets/ui_button.png")}create(){console.log("BootScene started");const{width:t,height:s}=this.scale;console.log(`Scale detected: ${t}x${s}`);try{console.log("Adding background..."),this.add.rectangle(0,0,t,s,l.sky).setOrigin(0),console.log("Adding ground...");const i=this.add.graphics();i.fillStyle(l.grass,1),i.fillRect(0,s*.7,t,s*.3),console.log("Adding dog icon..."),typeof y>"u"?console.error("DrawUtils is undefined!"):(this.dog=y.dogIcon(this,t/2,s/2-20,1.5),console.log("Dog icon created"),this.tweens.add({targets:this.dog,y:this.dog.y-15,duration:500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})),console.log("Adding text..."),this.statusText=this.add.text(t/2,s/2+60,"„Çà„Åø„Åì„Åø„Å°„ÇÖ„ÅÜ...",{fontSize:"18px",fontFamily:"sans-serif",color:l.textDark}).setOrigin(.5),console.log("Adding paw progress..."),this.pawProgress=this.add.container(t/2,s/2+95),setTimeout(()=>this.initializeLevels(),300),console.log("BootScene create completed")}catch(i){console.error("CRITICAL ERROR in BootScene:",i),console.error(i.stack)}}initializeLevels(){if(typeof k<"u"){const s=new k(6);p=[];const i=new Set;let e=0;const o=()=>{let n=0;for(;n<25&&p.length<100;){const a=p.length<30?1:p.length<70?2:3,c=s.generate({difficulty:a,maxAttempts:50});if(c){const h=c.snacks.map(d=>`${d.row},${d.col},${d.type}`).sort().join("|");i.has(h)?e++:(i.add(h),c.id=p.length+1,p.push(c),e=0)}else e++;e>30&&(i.clear(),e=0),n++}this.statusText.setText(`„Çπ„ÉÜ„Éº„Ç∏ÁîüÊàê‰∏≠... ${p.length}/100`),this.pawProgress.removeAll(!0);const r=Math.floor(p.length/10);for(let a=0;a<r;a++){const c=y.pawPrint(this,(a-4.5)*25,0,l.snack1,12);this.pawProgress.add(c)}p.length<100?setTimeout(o,10):(this.statusText.setText("„Åã„Çì„Çä„Çá„ÅÜÔºÅ"),setTimeout(()=>this.scene.start("TitleScene"),600))};o()}else p=[{id:1,gridSize:6,pathCount:4,snacks:[{row:0,col:0,type:1},{row:5,col:5,type:1},{row:0,col:5,type:2},{row:5,col:0,type:2},{row:2,col:0,type:3},{row:3,col:5,type:3},{row:3,col:0,type:4},{row:2,col:5,type:4}]}],this.scene.start("TitleScene")}}class T extends g.Scene{constructor(){super({key:"TitleScene"})}create(){const{width:t,height:s}=this.scale;this.createBackground(),this.createTitle(),this.createDog(),this.createButtons(),this.cameras.main.fadeIn(500)}createBackground(){const{width:t,height:s}=this.scale;this.add.rectangle(0,0,t,s,l.sky).setOrigin(0);const i=this.add.graphics();i.fillStyle(13882304,1),i.fillRect(20,s*.35,60,80),i.fillRect(t-100,s*.32,80,90),i.fillStyle(13458524,1),i.beginPath(),i.moveTo(10,s*.35),i.lineTo(50,s*.28),i.lineTo(90,s*.35),i.closePath(),i.fillPath(),i.fillStyle(l.grass,1);for(let e=0;e<t;e+=30)i.fillCircle(e,s*.45,20);i.lineStyle(2,l.grassDark,1);for(let e=0;e<t;e+=30)i.strokeCircle(e,s*.45,20);i.fillStyle(l.ground,1),i.fillRect(0,s*.5,t,s*.5),i.fillStyle(l.grass,1),i.fillEllipse(t/2,s*.75,t*.9,s*.35),i.lineStyle(2,l.grassDark,1),i.strokeEllipse(t/2,s*.75,t*.9,s*.35),y.tree(this,50,s*.55,.8),y.tree(this,t-40,s*.52,.6);for(let e=0;e<5;e++)y.flower(this,g.Math.Between(60,t-60),s*.65+g.Math.Between(-10,10),[16777215,16758465,16776960][g.Math.Between(0,2)]);for(let e=0;e<8;e++)y.grassCluster(this,g.Math.Between(30,t-30),s*.7+g.Math.Between(-5,15))}createTitle(){const{width:t,height:s}=this.scale,i=this.add.graphics();i.fillStyle(l.uiBg,1),i.fillRoundedRect(t/2-130,s*.12,260,70,10),i.lineStyle(3,l.uiOutline,1),i.strokeRoundedRect(t/2-130,s*.12,260,70,10),this.add.text(t/2,s*.15+35,"„ÅÑ„Å¨„Åï„Çì„ÅΩ",{fontSize:"36px",fontFamily:"sans-serif",fontStyle:"bold",color:l.textDark}).setOrigin(.5),y.pawPrint(this,t/2-100,s*.15+35,l.snack1,14),y.pawPrint(this,t/2+100,s*.15+35,l.snack2,14)}createDog(){const{width:t,height:s}=this.scale;y.dogHouse(this,t/2+80,s*.58,.7),this.dog=y.dogIcon(this,t/2-40,s*.52,1.8,14596231),this.tweens.add({targets:this.dog,y:this.dog.y-10,scaleY:.95,duration:400,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.time.addEvent({delay:2500,callback:()=>{const i=this.add.text(this.dog.x+g.Math.Between(-20,20),this.dog.y-50,"‚ô•",{fontSize:"24px",color:"#FF6B6B"}).setOrigin(.5).setAlpha(0);this.tweens.add({targets:i,y:i.y-40,alpha:{from:1,to:0},scale:{from:.5,to:1.2},duration:1e3,onComplete:()=>i.destroy()})},loop:!0})}createButtons(){const{width:t,height:s}=this.scale;this.createButton(t/2,s*.78,"„ÅÇ„Åù„Å∂",l.snack2,()=>{this.cameras.main.fadeOut(300),this.time.delayedCall(300,()=>this.scene.start("SelectScene"))}),this.createButton(t/2,s*.88,"„ÉÅ„É£„É¨„É≥„Ç∏",l.snack1,()=>{this.cameras.main.fadeOut(300),this.time.delayedCall(300,()=>this.scene.start("GameScene",{mode:"challenge"}))});const i=localStorage.getItem("challengeHighScore")||"0";this.add.text(t-15,20,`üèÜ ${i}`,{fontSize:"16px",color:l.textDark}).setOrigin(1,0)}createButton(t,s,i,e,o){const n=this.add.container(t,s),r=this.add.graphics();r.fillStyle(8947848,.3),r.fillRoundedRect(-85,-18,170,40,8),r.y=4;const a=this.add.graphics();a.fillStyle(e,1),a.fillRoundedRect(-85,-20,170,40,8),a.lineStyle(2,l.cellOutline,1),a.strokeRoundedRect(-85,-20,170,40,8);const c=this.add.text(0,0,i,{fontSize:"20px",fontFamily:"sans-serif",fontStyle:"bold",color:l.textLight}).setOrigin(.5);return n.add([r,a,c]),n.setSize(170,40),n.setInteractive({useHandCursor:!0}),n.on("pointerover",()=>this.tweens.add({targets:n,scale:1.05,duration:80})),n.on("pointerout",()=>this.tweens.add({targets:n,scale:1,duration:80})),n.on("pointerdown",()=>this.tweens.add({targets:n,y:s+3,duration:50})),n.on("pointerup",()=>{this.tweens.add({targets:n,y:s,duration:80}),o()}),n}}class B extends g.Scene{constructor(){super({key:"SelectScene"}),this.page=0,this.perPage=12}create(){const{width:t,height:s}=this.scale;this.add.rectangle(0,0,t,s,l.sky).setOrigin(0);const i=this.add.graphics();i.fillStyle(l.ground,1),i.fillRect(0,s*.15,t,s*.85);const e=this.add.graphics();e.fillStyle(l.uiBg,1),e.fillRect(0,0,t,55),e.lineStyle(2,l.uiOutline,1),e.lineBetween(0,55,t,55),this.createBackButton(45,28),this.add.text(t/2,28,"„Çπ„ÉÜ„Éº„Ç∏„Åõ„Çì„Åü„Åè",{fontSize:"20px",fontFamily:"sans-serif",fontStyle:"bold",color:l.textDark}).setOrigin(.5),this.createGrid(),this.createPagination(),this.cameras.main.fadeIn(300)}createBackButton(t,s){const i=this.add.container(t,s),e=this.add.graphics();e.fillStyle(l.snack3,1),e.fillRoundedRect(-30,-18,60,36,8),e.lineStyle(2,l.cellOutline,1),e.strokeRoundedRect(-30,-18,60,36,8);const o=this.add.text(0,0,"‚Üê ",{fontSize:"18px",color:l.textDark}).setOrigin(.5);return i.add([e,o]),i.setSize(60,36),i.setInteractive({useHandCursor:!0}),i.on("pointerup",()=>{this.cameras.main.fadeOut(300),this.time.delayedCall(300,()=>this.scene.start("TitleScene"))}),i}createGrid(){const{width:t,height:s}=this.scale,i=3,e=90,o=100,n=12,r=i*e+(i-1)*n,a=(t-r)/2,c=75,h=this.page*this.perPage,d=Math.min(h+this.perPage,p.length);for(let f=h;f<d;f++){const u=f-h,x=u%i,w=Math.floor(u/i),D=a+x*(e+n)+e/2,O=c+w*(o+n)+o/2;this.createCard(D,O,e,o,f)}}createCard(t,s,i,e,o){const n=this.add.container(t,s),r=p[o],a=this.add.graphics();a.fillStyle(8947848,.2),a.fillRoundedRect(-i/2,-e/2,i,e,8),a.x=3,a.y=3;const c=this.add.graphics();c.fillStyle(l.cellBg,1),c.fillRoundedRect(-i/2,-e/2,i,e,8),c.lineStyle(2,l.cellOutline,1),c.strokeRoundedRect(-i/2,-e/2,i,e,8);const h=this.add.text(0,-e/2+16,`${o+1}`,{fontSize:"16px",fontStyle:"bold",color:l.textDark}).setOrigin(.5),d=this.createPreview(r,42);return n.add([a,c,h,d]),n.setSize(i,e),n.setInteractive({useHandCursor:!0}),n.on("pointerover",()=>this.tweens.add({targets:n,scale:1.08,y:s-3,duration:80})),n.on("pointerout",()=>this.tweens.add({targets:n,scale:1,y:s,duration:80})),n.on("pointerup",()=>{this.cameras.main.fadeOut(300),this.time.delayedCall(300,()=>this.scene.start("GameScene",{mode:"normal",levelIndex:o}))}),n.setScale(0),this.tweens.add({targets:n,scale:1,duration:200,delay:o%this.perPage*30,ease:"Back.easeOut"}),n}createPreview(t,s){const i=this.add.container(0,15),e=s/6,o=-s/2,n=this.add.graphics();n.fillStyle(l.grass,.3),n.fillRoundedRect(o-2,o-2,s+4,s+4,4),i.add(n);for(let r=0;r<6;r++)for(let a=0;a<6;a++){const c=o+a*e+e/2,h=o+r*e+e/2,d=t.snacks.find(u=>u.row===r&&u.col===a),f=this.add.graphics();d?(f.fillStyle(C[d.type].color,1),f.fillCircle(c,h,e*.35),f.lineStyle(1,l.cellOutline,1),f.strokeCircle(c,h,e*.35)):(f.fillStyle(l.cellBg,1),f.fillCircle(c,h,e*.2)),i.add(f)}return i}createPagination(){const{width:t,height:s}=this.scale,i=Math.ceil(p.length/this.perPage);this.add.text(t/2,s-45,`${this.page+1} / ${i}`,{fontSize:"14px",color:l.textDark}).setOrigin(.5),this.page>0&&this.add.text(t/2-60,s-45,"‚óÄ",{fontSize:"20px",color:l.textDark}).setOrigin(.5).setInteractive({useHandCursor:!0}).on("pointerup",()=>{this.page--,this.scene.restart()}),this.page<i-1&&this.add.text(t/2+60,s-45,"‚ñ∂",{fontSize:"20px",color:l.textDark}).setOrigin(.5).setInteractive({useHandCursor:!0}).on("pointerup",()=>{this.page++,this.scene.restart()})}}class P extends g.Scene{constructor(){super({key:"GameScene"})}init(t){this.mode=t.mode||"normal",this.lvIndex=t.levelIndex||0,this.chalScore=t.challengeScore||0,this.combo=0}create(){const{width:t,height:s}=this.scale;this.createBackground(),this.loadLevel(),this.createGrid(),this.createUI(),this.setupInput(),this.playEntryAnim(),this.cameras.main.fadeIn(300)}createBackground(){const{width:t,height:s}=this.scale;this.add.rectangle(0,0,t,s,l.sky).setOrigin(0);const i=this.add.graphics();i.fillStyle(l.ground,1),i.fillRect(0,s*.12,t,s*.88),i.fillStyle(l.grass,1),i.fillRoundedRect(10,s*.16,t-20,s*.68,12),i.lineStyle(2,l.grassDark,1),i.strokeRoundedRect(10,s*.16,t-20,s*.68,12)}loadLevel(){if(this.mode==="challenge")if(typeof k<"u"){const t=new k(6),s=Math.min(3,1+Math.floor(this.chalScore/5));this.level=t.generate({difficulty:s,maxAttempts:50})||p[g.Math.Between(0,p.length-1)]}else this.level=p[g.Math.Between(0,p.length-1)];else this.level=p[this.lvIndex];this.grid=[];for(let t=0;t<6;t++){this.grid[t]=[];for(let s=0;s<6;s++)this.grid[t][s]={type:0,isEnd:!1,pathType:0}}this.maxType=Math.max(...this.level.snacks.map(t=>t.type)),this.level.snacks.forEach(t=>{this.grid[t.row][t.col]={type:t.type,isEnd:!0,pathType:t.type}}),this.paths={},this.trails={};for(let t=1;t<=this.maxType;t++)this.paths[t]=[],this.trails[t]=[];this.drawing=!1,this.curType=null,this.lastCell=null}createGrid(){const{width:t,height:s}=this.scale,i=80,e=65,o=25,n=s-i-e-o,r=t-o*2,a=Math.min(r,n);this.cellSz=(a-S.CELL_PADDING*7)/6,this.gridX=(t-a)/2+S.CELL_PADDING,this.gridY=i+(n-a)/2+S.CELL_PADDING,this.cellCon=this.add.container(0,0),this.cells=[];for(let c=0;c<6;c++){this.cells[c]=[];for(let h=0;h<6;h++){const d=this.gridX+h*(this.cellSz+S.CELL_PADDING),f=this.gridY+c*(this.cellSz+S.CELL_PADDING),u=this.add.container(d,f),x=this.add.graphics();y.roundedRect(x,0,0,this.cellSz,this.cellSz,S.CORNER_RADIUS,l.cellBg,l.cellOutline,2);const w=this.add.graphics();u.add([x,w]),u.setData("fill",w),this.cells[c][h]=u,this.cellCon.add(u)}}this.trailCon=this.add.container(0,0),this.snackCon=this.add.container(0,0),this.snacks={},this.level.snacks.forEach(c=>{const h=this.gridX+c.col*(this.cellSz+S.CELL_PADDING)+this.cellSz/2,d=this.gridY+c.row*(this.cellSz+S.CELL_PADDING)+this.cellSz/2,f=y.snackIcon(this,h,d,c.type,this.cellSz*.35);this.snackCon.add(f),this.snacks[`${c.row},${c.col}`]=f})}playEntryAnim(){for(let t=0;t<6;t++)for(let s=0;s<6;s++){const i=this.cells[t][s],e=i.y;i.y=e-40,i.alpha=0,this.tweens.add({targets:i,y:e,alpha:1,duration:250,delay:(t+s)*20,ease:"Back.easeOut"})}this.snackCon.list.forEach((t,s)=>{const i=t.scaleX;t.setScale(0),this.tweens.add({targets:t,scaleX:i,scaleY:i,duration:300,delay:280+s*35,ease:"Back.easeOut"})})}createUI(){const{width:t,height:s}=this.scale,i=this.add.graphics();i.fillStyle(l.uiBg,1),i.fillRect(0,0,t,55),i.lineStyle(2,l.uiOutline,1),i.lineBetween(0,55,t,55),this.createSmallButton(40,28,"‚Üê",()=>{this.mode==="challenge"?this.showConfirm():(this.cameras.main.fadeOut(300),this.time.delayedCall(300,()=>this.scene.start("SelectScene")))});const e=this.mode==="challenge"?`üî• ${this.chalScore+1}`:`${this.lvIndex+1}`;this.add.text(t/2,28,e,{fontSize:"22px",fontStyle:"bold",color:l.textDark}).setOrigin(.5),this.progContainer=this.add.container(t/2,65),this.updateProgress();const o=this.add.graphics();o.fillStyle(l.uiBg,1),o.fillRect(0,s-50,t,50),o.lineStyle(2,l.uiOutline,1),o.lineBetween(0,s-50,t,s-50),this.createSmallButton(t/2-40,s-25,"‚Ü∫",()=>this.resetLevel()),this.createSmallButton(t/2+40,s-25,"?",()=>console.log("„Éí„É≥„Éà"))}createSmallButton(t,s,i,e){const o=this.add.container(t,s),n=this.add.graphics();n.fillStyle(l.snack3,1),n.fillRoundedRect(-22,-18,44,36,8),n.lineStyle(2,l.cellOutline,1),n.strokeRoundedRect(-22,-18,44,36,8);const r=this.add.text(0,0,i,{fontSize:"20px",fontStyle:"bold",color:l.textDark}).setOrigin(.5);return o.add([n,r]),o.setSize(44,36),o.setInteractive({useHandCursor:!0}),o.on("pointerdown",()=>this.tweens.add({targets:o,scale:.9,duration:50})),o.on("pointerup",()=>{this.tweens.add({targets:o,scale:1,duration:80}),e()}),o}setupInput(){this.input.on("pointerdown",t=>this.onDown(t)),this.input.on("pointermove",t=>this.onMove(t)),this.input.on("pointerup",()=>this.onUp())}onDown(t){const s=this.getCell(t.x,t.y);if(!s)return;const{row:i,col:e}=s,o=this.grid[i][e];o.isEnd?(this.startDraw(o.type,i,e),this.showDog(t.x,t.y)):o.pathType>0&&(this.startFromPath(o.pathType,i,e),this.showDog(t.x,t.y))}onMove(t){if(!this.drawing)return;const s=this.getCell(t.x,t.y);s&&this.continueDraw(s.row,s.col),this.dog&&this.dog.setPosition(t.x,t.y-55)}onUp(){if(this.mode==="challenge"&&this.drawing&&this.curType&&!this.pathComplete(this.curType)){this.cameras.main.shake(300,.02),this.cameras.main.flash(200,255,100,100),this.time.delayedCall(500,()=>this.scene.start("GameOverScene",{score:this.chalScore}));return}this.drawing=!1,this.curType=null,this.lastCell=null,this.hideDog()}getCell(t,s){for(let i=0;i<6;i++)for(let e=0;e<6;e++){const o=this.gridX+e*(this.cellSz+S.CELL_PADDING),n=this.gridY+i*(this.cellSz+S.CELL_PADDING);if(t>=o&&t<=o+this.cellSz&&s>=n&&s<=n+this.cellSz)return{row:i,col:e}}return null}startDraw(t,s,i){this.clearPath(t),this.drawing=!0,this.curType=t,this.lastCell={row:s,col:i},this.paths[t].push({row:s,col:i});const e=`${s},${i}`;this.snacks[e]&&this.tweens.add({targets:this.snacks[e],scaleX:1.2,scaleY:.8,duration:80,yoyo:!0})}startFromPath(t,s,i){const e=this.paths[t],o=e.findIndex(n=>n.row===s&&n.col===i);o!==-1&&(e.splice(o+1).forEach(n=>{this.grid[n.row][n.col].isEnd||(this.grid[n.row][n.col].pathType=0)}),this.trails[t]=this.trails[t].slice(0,o),this.drawing=!0,this.curType=t,this.lastCell={row:s,col:i},this.renderPaths())}continueDraw(t,s){if(!this.drawing||!this.curType)return;const{row:i,col:e}=this.lastCell;if(t===i&&s===e||Math.abs(t-i)+Math.abs(s-e)!==1)return;const o=this.grid[t][s],n=this.paths[this.curType];if(n.length>=2){const r=n[n.length-2];if(r.row===t&&r.col===s){const a=n.pop();this.grid[a.row][a.col].isEnd||(this.grid[a.row][a.col].pathType=0),this.trails[this.curType].pop(),this.lastCell={row:t,col:s},this.updateProgress(),this.renderPaths();return}}if(!(o.pathType>0&&o.pathType!==this.curType)){if(o.isEnd&&o.type===this.curType){if(n[0].row===t&&n[0].col===s)return;n.push({row:t,col:s}),this.addTrail(i,e,t,s),this.lastCell={row:t,col:s},this.combo++;const r=`${t},${s}`;this.snacks[r]&&this.tweens.add({targets:this.snacks[r],scale:1.3,duration:150,yoyo:!0,ease:"Back.easeOut"}),this.showConnectEffect(t,s),this.updateProgress(),this.renderPaths(),this.checkClear();return}o.pathType!==this.curType&&(o.isEnd&&o.type!==this.curType||(n.push({row:t,col:s}),o.pathType=this.curType,this.addTrail(i,e,t,s),this.lastCell={row:t,col:s},this.updateProgress(),this.renderPaths()))}}addTrail(t,s,i,e){const o=this.gridX+s*(this.cellSz+S.CELL_PADDING)+this.cellSz/2,n=this.gridY+t*(this.cellSz+S.CELL_PADDING)+this.cellSz/2,r=this.gridX+e*(this.cellSz+S.CELL_PADDING)+this.cellSz/2,a=this.gridY+i*(this.cellSz+S.CELL_PADDING)+this.cellSz/2;this.trails[this.curType].push({x:(o+r)/2,y:(n+a)/2,angle:Math.atan2(a-n,r-o)})}renderPaths(){for(let t=0;t<6;t++)for(let s=0;s<6;s++){const i=this.cells[t][s].getData("fill"),e=this.grid[t][s].pathType;i.clear(),e>0&&(i.fillStyle(C[e].color,.5),i.fillRoundedRect(2,2,this.cellSz-4,this.cellSz-4,S.CORNER_RADIUS-2))}this.trailCon.removeAll(!0);for(let t=1;t<=this.maxType;t++){const s=this.trails[t];s&&s.forEach((i,e)=>{const o=y.pawPrint(this,i.x,i.y,C[t].color,this.cellSz*.22);o.setRotation(i.angle+Math.PI/2),o.setAlpha(.6+e/s.length*.4),this.trailCon.add(o)})}}showConnectEffect(t,s){const i=this.gridX+s*(this.cellSz+S.CELL_PADDING)+this.cellSz/2,e=this.gridY+t*(this.cellSz+S.CELL_PADDING)+this.cellSz/2;for(let o=0;o<6;o++){const n=o/6*Math.PI*2,r=this.add.text(i,e,"‚ú¶",{fontSize:"16px",color:"#FFD700"}).setOrigin(.5);this.tweens.add({targets:r,x:i+Math.cos(n)*40,y:e+Math.sin(n)*40,alpha:0,scale:0,duration:400,ease:"Cubic.easeOut",onComplete:()=>r.destroy()})}}clearPath(t){this.paths[t].forEach(s=>{this.grid[s.row][s.col].isEnd||(this.grid[s.row][s.col].pathType=0)}),this.paths[t]=[],this.trails[t]=[],this.renderPaths()}resetLevel(){for(let t=1;t<=this.maxType;t++)this.clearPath(t);for(let t=0;t<6;t++)for(let s=0;s<6;s++)this.grid[t][s].isEnd||(this.grid[t][s].pathType=0);this.combo=0,this.updateProgress(),this.renderPaths(),this.cameras.main.shake(100,.005)}showDog(t,s){this.dog||(this.dog=y.dogIcon(this,t,s-55,.8,14596231)),this.dog.setPosition(t,s-55).setVisible(!0),this.dogTween||(this.dogTween=this.tweens.add({targets:this.dog,scaleX:{from:1,to:1.1},duration:100,yoyo:!0,repeat:-1}))}hideDog(){this.dog&&this.dog.setVisible(!1),this.dogTween&&(this.dogTween.stop(),this.dogTween=null)}updateProgress(){let t=0;for(let i=0;i<6;i++)for(let e=0;e<6;e++)this.grid[i][e].pathType>0&&t++;this.progContainer.removeAll(!0);const s=Math.floor(t/36*10);for(let i=0;i<s;i++){const e=y.pawPrint(this,(i-4.5)*18,0,l.snack1,8);this.progContainer.add(e)}}pathComplete(t){const s=this.paths[t];if(!s||s.length<2)return!1;const i=[];for(let a=0;a<6;a++)for(let c=0;c<6;c++)this.grid[a][c].isEnd&&this.grid[a][c].type===t&&i.push({row:a,col:c});if(i.length!==2)return!1;const e=s[0],o=s[s.length-1],n=e.row===i[0].row&&e.col===i[0].col||e.row===i[1].row&&e.col===i[1].col,r=o.row===i[0].row&&o.col===i[0].col||o.row===i[1].row&&o.col===i[1].col;return n&&r&&(e.row!==o.row||e.col!==o.col)}checkClear(){for(let t=1;t<=this.maxType;t++)if(!this.pathComplete(t))return!1;for(let t=0;t<6;t++)for(let s=0;s<6;s++)if(this.grid[t][s].pathType===0)return!1;return this.cameras.main.flash(200,255,255,200),this.time.delayedCall(600,()=>{this.mode==="challenge"?this.scene.start("ClearScene",{mode:"challenge",challengeScore:this.chalScore+1}):this.scene.start("ClearScene",{mode:"normal",levelIndex:this.lvIndex})}),!0}showConfirm(){const{width:t,height:s}=this.scale,i=this.add.rectangle(0,0,t,s,0,.5).setOrigin(0),e=this.add.container(t/2,s/2),o=this.add.graphics();o.fillStyle(l.uiBg,1),o.fillRoundedRect(-110,-60,220,120,12),o.lineStyle(2,l.cellOutline,1),o.strokeRoundedRect(-110,-60,220,120,12);const n=this.add.text(0,-25,"„ÇÑ„ÇÅ„Åæ„Åô„ÅãÔºü",{fontSize:"18px",color:l.textDark}).setOrigin(.5),r=this.add.text(-40,25,"„ÅØ„ÅÑ",{fontSize:"16px",color:l.snack1}).setOrigin(.5).setInteractive({useHandCursor:!0}),a=this.add.text(40,25,"„ÅÑ„ÅÑ„Åà",{fontSize:"16px",color:l.textDark}).setOrigin(.5).setInteractive({useHandCursor:!0});e.add([o,n,r,a]),r.on("pointerup",()=>this.scene.start("TitleScene")),a.on("pointerup",()=>{i.destroy(),e.destroy()})}}class E extends g.Scene{constructor(){super({key:"ClearScene"})}init(t){this.mode=t.mode||"normal",this.lvIndex=t.levelIndex||0,this.chalScore=t.challengeScore||0}create(){const{width:t,height:s}=this.scale;this.add.rectangle(0,0,t,s,l.sky).setOrigin(0);const i=this.add.graphics();i.fillStyle(l.grass,1),i.fillRect(0,s*.6,t,s*.4),this.createConfetti(),this.mode==="challenge"?this.createChallengeClear():this.createNormalClear()}createConfetti(){const{width:t,height:s}=this.scale;for(let i=0;i<25;i++){const e=g.Math.Between(20,t-20),n=[l.snack1,l.snack2,l.snack3,l.snack4][g.Math.Between(0,3)],r=this.add.graphics();r.fillStyle(n,1),r.fillRect(-4,-4,8,8),r.x=e,r.y=-20,this.tweens.add({targets:r,y:s+20,x:e+g.Math.Between(-60,60),rotation:g.Math.Between(-5,5),duration:g.Math.Between(1500,3e3),delay:g.Math.Between(0,600),onComplete:()=>r.destroy()})}}createNormalClear(){const{width:t,height:s}=this.scale,i=y.dogIcon(this,t/2,s*.35,2,14596231);i.setScale(0),this.tweens.add({targets:i,scale:1,duration:400,ease:"Back.easeOut"}),this.tweens.add({targets:i,y:i.y-15,duration:500,delay:500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"});for(let e=0;e<3;e++)this.time.delayedCall(600+e*200,()=>{const o=this.add.text(t/2+(e-1)*50,s*.18,"‚ô•",{fontSize:"36px",color:"#FF6B6B"}).setOrigin(.5).setAlpha(0);this.tweens.add({targets:o,alpha:1,scale:{from:.5,to:1},duration:300,ease:"Back.easeOut"})});this.add.text(t/2,s*.55,"„ÇØ„É™„Ç¢ÔºÅ",{fontSize:"36px",fontStyle:"bold",color:l.textDark}).setOrigin(.5),this.add.text(t/2,s*.62,"„Åä„Åï„Çì„ÅΩ „Åü„ÅÆ„Åó„Åã„Å£„Åü„Å≠ÔºÅ",{fontSize:"16px",color:l.textDark}).setOrigin(.5),this.time.delayedCall(800,()=>{const e=this.createButton(t/2,s*.78,"„Å§„Åé„Å∏",l.snack2,()=>{this.scene.start("GameScene",{mode:"normal",levelIndex:(this.lvIndex+1)%p.length})});e.setScale(0),this.tweens.add({targets:e,scale:1,duration:300,ease:"Back.easeOut"})})}createChallengeClear(){const{width:t,height:s}=this.scale,i=this.add.text(t/2,s*.3,this.chalScore.toString(),{fontSize:"80px",fontStyle:"bold",color:l.snack1}).setOrigin(.5).setScale(0);this.tweens.add({targets:i,scale:1,duration:400,ease:"Back.easeOut"}),y.dogIcon(this,t/2,s*.5,1.5,14596231),this.add.text(t/2,s*.65,"„Å§„Åé„ÅÆ„Çπ„ÉÜ„Éº„Ç∏„Å∏ÔºÅ",{fontSize:"18px",color:l.textDark}).setOrigin(.5),this.time.delayedCall(1400,()=>{this.scene.start("GameScene",{mode:"challenge",challengeScore:this.chalScore})})}createButton(t,s,i,e,o){const n=this.add.container(t,s),r=this.add.graphics();r.fillStyle(e,1),r.fillRoundedRect(-70,-20,140,40,8),r.lineStyle(2,l.cellOutline,1),r.strokeRoundedRect(-70,-20,140,40,8);const a=this.add.text(0,0,i,{fontSize:"18px",fontStyle:"bold",color:l.textLight}).setOrigin(.5);return n.add([r,a]),n.setSize(140,40),n.setInteractive({useHandCursor:!0}),n.on("pointerup",o),n}}class b extends g.Scene{constructor(){super({key:"GameOverScene"})}init(t){this.score=t.score||0}create(){const{width:t,height:s}=this.scale;this.add.rectangle(0,0,t,s,3093826,.95).setOrigin(0),y.dogIcon(this,t/2,s*.25,1.5,10526880),this.add.text(t/2,s*.42,"„Ç≤„Éº„É†„Ç™„Éº„Éê„Éº",{fontSize:"28px",fontStyle:"bold",color:l.snack1}).setOrigin(.5),this.add.text(t/2,s*.52,"„ÇØ„É™„Ç¢„Åô„ÅÜ",{fontSize:"14px",color:"#888888"}).setOrigin(.5),this.add.text(t/2,s*.6,this.score.toString(),{fontSize:"56px",fontStyle:"bold",color:"#FFD700"}).setOrigin(.5);const i=parseInt(localStorage.getItem("challengeHighScore")||"0"),e=this.score>i;e&&localStorage.setItem("challengeHighScore",this.score.toString()),e&&this.add.text(t/2,s*.7,"NEW RECORD!",{fontSize:"18px",color:"#FFD700"}).setOrigin(.5),this.add.text(t/2,s*.77,`„Éô„Çπ„Éà: ${Math.max(i,this.score)}`,{fontSize:"14px",color:"#FFD700"}).setOrigin(.5),this.time.delayedCall(500,()=>{this.createButton(t/2-55,s*.88,"„É™„Éà„É©„Ç§",l.snack1,()=>{this.scene.start("GameScene",{mode:"challenge"})}),this.createButton(t/2+55,s*.88,"„Çø„Ç§„Éà„É´",6710886,()=>{this.scene.start("TitleScene")})})}createButton(t,s,i,e,o){const n=this.add.container(t,s),r=this.add.graphics();r.fillStyle(e,1),r.fillRoundedRect(-45,-16,90,32,6),r.lineStyle(2,l.cellOutline,1),r.strokeRoundedRect(-45,-16,90,32,6);const a=this.add.text(0,0,i,{fontSize:"14px",color:l.textLight}).setOrigin(.5);return n.add([r,a]),n.setSize(90,32),n.setInteractive({useHandCursor:!0}),n.setScale(0),this.tweens.add({targets:n,scale:1,duration:250,ease:"Back.easeOut"}),n.on("pointerup",o),n}}const z={type:g.AUTO,parent:"game-container",backgroundColor:"#F5F5F0",scale:{mode:g.Scale.FIT,autoCenter:g.Scale.CENTER_BOTH,width:400,height:680},autoFocus:!1,scene:[R,T,B,P,E,b]};console.log("üêï „ÅÑ„Å¨„Åï„Çì„ÅΩ - „Å≠„Åì„ÅÇ„Å§„ÇÅÈ¢®„Çπ„Çø„Ç§„É´");const F=new g.Game(z);window.game=F;
